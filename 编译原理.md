# 编译原理

## 词法分析

词法分析是编译的第一阶段，词法分析器的主要内容是读入源程序的输入字符，将它们组成词素(lexeme)，生成并输出一个词法单元(token)序列，每个词法单元对应于一个词素

* **词法单元**由一个**词法单元名**和一个**可选的属性值**组成。

  * **词法单元名**是一个表示某种词法单元的抽象符号

* **模式**描述了一个词法单元的词素可能具有的形式。（个人的理解是模式是匹配词素的**规则**）

  > 当词法单元是一个关键字时，它的模式就是组成这个关键字的字符序列。对于标识符和其他词法单元，模式是一个更加复杂的结构。它可以和很多符号串匹配。
  
* **词素**是源程序中的一个字符序列，它和某个词法单元的**模式**匹配，并被词法分析器识别为该词法单元的一个实例。

---

对很多程序设计语言而言，以下类别覆盖了大部分或所有的词法单元

1. 每个关键字有一个词法单元。一个关键字的模式就是该关键字的本身
2. 表示运算符的词法单元
3. 一个或多个表示常量的词法单元，比如数字和字面值字符串
4. 每一个标点符号具有一个词法单元，比如左右括号，逗号和分号

## 语法分析

### 文法定义

一个上下文无关文法由四个元素组成：

1. 一个**终结符号**集合，它们有时也称为“词法单元”。终结符号是该文法所定义的语言的**基本符号**的集合。

2. 一个**非终结符号**集合，它们有时也成为“语法变量”。每个非终结符号表示一个终结符号串的集合。

3. 一个**产生式**集合。其中每个产生式包括一个称为*产生式头*或*左部*的非终结符号，一个箭头，和一个称为*产生式体*或*右部*的由终结符号及非终结符号组成的序列。

   产生式主要用来表示某个构造的某种书写形式。如果产生式头非终结符号代表一个构造，那么该产生式体就代表了该构造的一种书写方式。

   > e.g. `stmt -> if(expr) stmt else stmt`
   >
   > 其中`->`读作“可以具有如下形式”

4. 指定一个非终结符号为**开始**符号。

   > 一般情况下，在描述文法的时候，开始符号对应的产生式被首先列出

---------

* 语法分析的任务：接受一个终结符号串作为输入，找出从文法的开始符号推导出这个串的方法。如果不能从文法的开始符号推导得到该终结符号串，则报告该中介符号所含的语法错误。

### 语法分析器的作用

语法分析器从词法分析器获得一个由此法单元组成的串，并验证这个串可以由源语言的文法生成。

我们期望语法分析器能够以易于理解的方式**报告语法错误**，并且能够**从常见的错误中恢复**并继续处理程序的其他部分。

> 简而言之，语法分析器起到一个**检查语法**，**异常恢复**的作用

### 语法错误的处理

程序可能具有不同层次的错误

* 词法错误：包括标识符、关键字或运算符拼写错误和没有在字符串文本上正确地加上引号
* 语法错误：包括分号放错地方、花括号的多余或缺失，对应语句缺乏相应语句（case外没有switch，或else没有if等）
* 语法错误：包括运算符和运算分量之间的类型不匹配，如函数声明的返回值和实际返回值类型不同
* 逻辑错误：可以是因程序员的错误推理而引起的任何错误。例如`==`写作了`=`（可能是报warning?）

语法分析中的错误处理目标

* 报告出现的错误
* 能从各个错误中恢复，以继续检测后面的错误
* 尽可能少地增加处理正确程序的开销

### 错误恢复策略

#### 恐慌模式的恢复

#### 短语层次的恢复

#### 错误产生式

#### 全局纠正

### 上下文无关语法

* 终结符号、非终结符号、开始符号、产生式
* 推导、一步推导、零步或多步推导
* 句型、句子
* 文法生成的语言

可以由文法生成的语言被称为上下文无关语言

* 最左推导、最右推导
* 语法分析树

### 设计文法

* 消除二义性
* 消除左递归
* 提取左公因子
* 非上下文无关语言的构造

### 4.4 自顶向下的语法分析

自顶向下语法分析可以被看作是**为输入串构造语法分析树**的问题

#### 递归下降的语法分析

即从开始符号开始，不断模拟最左展开，来检查是否与输入串匹配的暴力递归过程（不匹配则回溯）

> 后续的若干文法，例如LL(1)文法，是提出若干高级方案来替换效率低下的暴力过程的

一个左递归的文法会使它的递归下降语法分析器进入到一个无限循环（消除左递归的必要性？）

#### FIRST和FOLLOW

//todo

#### LL(1)文法

LL(1)语法构造出预测分析器，即不需要回溯的递归下降语法分析器

LL(1)的第一个L表示从左向右扫描输入，第二个L表示产生最左推导，而1表示在每一步中只需要向前看一个输入符号来决定语法分析动作

### 4.5 自底向上的语法分析
